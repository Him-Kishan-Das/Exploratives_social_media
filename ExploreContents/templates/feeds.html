
{% load static %} 


{% block content %} {% for post in posts reversed %}
<div class="feeds-container">
  <div class="sub-container1">
    {% comment %} profile image {% endcomment %}
    <div class="profile">
      <img src="{% static "man.png" %}" class="profile-img" alt="logo">
{% comment %} 
      {% for userProfile in userx %}
        {% if post.user_id == userProfile.id %} {% endcomment %}

          <div class="sub-profile">
            <h4 class="profile-username">{{ post.user.get_username }}</h4>
            <p class="profile-name">{{ post.user.name }}</p>

          </div>


        {% comment %} {% endif %}
      {% endfor %} {% endcomment %}
    </div>
  </div>

  <img src="{{ post.post_image.url }}" alt="kitten-photo" class="feeds-picture">


  <div class="sub-container2">
    <div class="likes-comment-section">
      <form action="/like-btn/" method="post">
        {% csrf_token %}
        <input type="hidden" name="post_id" value="{{ post.id }}">
        {% if post.id in liked_post_ids %}
          <button type="submit" style="background: none; border: none; margin-right: 8px;">
              <i class="fa-regular fa-heart" style="color: red;"></i>
          </button>
        {% else %}
          <button type="submit" style="background: none; border: none; margin-right: 8px">
            <i class="fa-regular fa-heart"></i>
          </button>
        {% endif %}
      </form>


        <button type="submit" id="openModalBtn{{ post.id }}" onclick="loadComments({{ post.id }})" style="background: none; border: none; margin-right: 8px">
          <i class="fa-regular fa-comment"></i>
        </button>
      

        {% comment %} comment modal starts here  {% endcomment %}
        <div id="uniqueModal{{ post.id }}" class="unique-modal">
          <!-- Modal content -->
          <div class="unique-modal-content">
              <span class="unique-close" onclick="closeModal({{ post.id }})">&times;</span>
              <h1 style="text-align: center;">Comments</h1>
              <hr>
              <div id="comments-container-{{ post.id }}" class="comment-container">
                  <!-- Comments will be loaded here -->
                  {% comment %} <hr> {% endcomment %}
                  {% comment %} <form action="/comment-btn/" method="post" class="newComment">
                      {% csrf_token %}
                      <input type="hidden" name="newComment_postid" value="{{ post.id }}" />
                      <input type="text" name="newComment" class="newComment-input"/>
                      <button type="submit" class="newCommentPostBtn">Post</button>
                  </form> {% endcomment %}
              </div>
          </div>
      </div>
      

    {% comment %} comment modal ends here  {% endcomment %}
      
    </div>
    <div class="save">
      <i class="fa-regular fa-bookmark"></i>
    </div>
  </div>

  <div class="likes-view">
    <p>{{ post.total_likes }} likes</p>
  </div>

  <div class="caption">{{ post.post_caption }}</div>

  <div class="date">
    <p> {{ post.post_timestamp|date:"d F, Y" }}</p>
  </div>
</div>
    

{% endfor %} {% endblock %}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
  function loadComments(postId) {
    $.ajax({
        url: `/load-comments/${postId}/`,
        type: "GET",
        success: function(response) {
            let commentsContainer = document.getElementById(`comments-container-${postId}`);
            commentsContainer.innerHTML = '';
            response.comments.forEach(comment => {
                let div = document.createElement('div');
                div.classList.add('user-comment');
                div.innerHTML = `
                    <img src="/static/man.png" alt="" class="user-comment-profile">
                    <div style="padding-left: 5px">
                        <h4 class="user-comment-username">${comment.username}</h4>
                        <p class="user-comment-text">${comment.user_comment}</p>
                    </div>
                `;
                commentsContainer.appendChild(div);
            });

            // Add the form for new comments
            let formDiv = document.createElement('div');
            formDiv.innerHTML = `
                <hr>
                <form action="/comment-btn/" method="post" class="newComment">
                    {% csrf_token %}
                    <input type="hidden" name="newComment_postid" value="${postId}" />
                    <input type="text" name="newComment" class="newComment-input"/>
                    <button type="submit" class="newCommentPostBtn">Post</button>
                </form>
            `;
            commentsContainer.appendChild(formDiv);

            document.getElementById(`uniqueModal${postId}`).style.display = 'block';
        },
        error: function(error) {
            console.log("Error:", error);
        }
    });
}

function closeModal(postId) {
    document.getElementById(`uniqueModal${postId}`).style.display = 'none';
}


</script>
